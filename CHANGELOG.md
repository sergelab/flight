# Changelog

## v0.4.0
- Добавлено стабильное текстурирование террейна (Variant B):
  - 2 tile-текстуры (grass/rock) генерируются в рантайме
  - включён mipmapping + trilinear фильтрация (уменьшает shimmer)
  - смешивание материалов по высоте/уклону (без процедурных высоких частот)
- Product LOD: дальнее кольцо LOD чуть сильнее уходит в туман через `u_chunk_fade`
- CLI:
  - `--textures / --no-textures`
  - `--tex-scale`
  - `--far-fade`

### Как проверить
1) `poetry install`
2) `poetry run flight --debug`
3) По умолчанию должна появиться “зернистость” материала (grass/rock) без мерцания.
4) Сравнение: `poetry run flight --no-textures`.
5) При включении `--lod` переход дальнего кольца должен быть менее заметным.

## v0.3.0 (Final, Variant A: stability baseline)
- Убраны источники мерцания (процедурные контуры/noise/мелкие детали в шейдере)
- Зафиксирован базовый шейдер: palette-by-height + Lambert + fog (forward)
- LOD по умолчанию выключен (можно включить флагом, но это вне стабильного baseline)

### v0.3 update: разнообразный ландшафт + вода
- Генерация высот стала более разнообразной: domain-warp + macro layer (низкочастотно, без shimmer)
- Добавлены реки и озёра:
  - озёра: плоская поверхность на уровне `water_level`
  - реки: редкие источники + downhill trace, визуализация через маску воды
- Вершинный формат расширен: `pos(3) + norm(3) + water(1)`

### Как проверить
1) `poetry install`
2) `poetry run flight --debug`
3) Убедитесь, что видны синие области (озёра) и синеватые линии (реки), а рельеф заметно отличается от равномерного шума.

# CHANGELOG (v0.1.0)

## Hotfix: macOS OpenGL context request
- Добавлен запрос OpenGL 3.3 Core Profile через pygame GL attributes
- Добавлен fallback выбора GLSL версии (330/150) по версии контекста


## Что сделано
- Каркас приложения (pygame + ModernGL), запуск через `poetry run flight`
- Процедурная гористая поверхность на основе OpenSimplex (fBm)
- Бесконечный мир через чанки (коридор 5x8) с подгрузкой по мере полёта
- Фоновая генерация чанков (thread + очереди), дозированная загрузка в GPU
- Камера на "рельсах": движение вперёд, высота следует рельефу со сглаживанием
- Простое освещение (Lambert) + туман по дальности, цвет по высоте
- Документация для PM и технических специалистов + база знаний

## Как проверить
1) `poetry install`
2) `poetry run flight`
3) Наблюдайте непрерывный полёт вперёд без поворотов и без остановки мира.
4) Закройте окно или нажмите `Esc`.

## Изменения в интерфейсе/конфиге
- Добавлен CLI `flight` и параметры `--seed`, `--speed`, `--height-offset`, `--wireframe`

## Hotfix: terrain not visible
- Исправлен порядок индексов (winding) для корректной видимости при backface culling
- Отключён CULL_FACE по умолчанию (можно включить позже после проверки)

## Last fix: запуск + диагностика
- Исправлен debug-fix (World.update_requests не теряется)
- Добавлен debug triangle и периодический лог (z/y/chunks)
- Уточнён запрос OpenGL контекста под macOS

## Variant B (на основе текущей ветки)
- Warmup на старте (предзагрузка чанков)
- Флаг `--debug` включает HUD и логи
- Ускоренная подгрузка чанков первые 2 секунды

## v0.2
- Добавлены контурные линии по высоте (упрощают восприятие рельефа и движения)
- Добавлены CLI параметры: --chunk-res, --chunk-size, --fog-start, --fog-end
- Добавлен документ: docs/tech/apply_archives.md (как применять архивы)
- HUD в --debug показывает параметры мира и тумана

## v0.2.1
- Туман: изменён расчёт на более заметный (smoothstep по forward distance)
- Ускорена генерация чанков: добавлен векторизованный быстрый шум и height_grid

## v0.2.2 (закрытие v0.2)
- Добавлен sky-рендер (градиент + солнце как ориентир)
- Добавлен `--noise fast|simplex`
- Ускорена генерация чанков (векторизованная сетка высот)
- Туман сделан заметнее (forward smoothstep)

## v0.3.0 (A: FPS first)
- LOD: near/high + far/low, far обновляется реже
- Skirts по краям чанков
- Адаптивный upload/frame по target FPS
- CLI: --lod/--no-lod, --target-fps

## v0.3.5.1
- Fix: добавлен uniform u_chunk_fade и переменная cf в фрагментном шейдере.
